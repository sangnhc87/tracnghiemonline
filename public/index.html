<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hệ thống Thi Online - tracnghiemonline</title>

    <!-- Liên kết với Font Awesome để dùng icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Liên kết với file CSS tùy chỉnh của bạn -->
    <link rel="stylesheet" href="css/style.css" />

    <!-- public/index.html -> trong thẻ <head> -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-functions-compat.js"></script>

    <!-- SweetAlert2 để hiển thị thông báo đẹp mắt hơn -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  </head>
  <body>

    <!-- Giao diện Giáo viên Đăng nhập / Quản lý (mặc định ẩn) -->
    <div id="teacherLogin" style="display:none;">
      <h2>Chào mừng Giáo viên!</h2>
      <button onclick="signInWithGoogle()">Đăng nhập với Google</button>
      <div id="teacherInfo" style="margin-top:20px;"></div>
      <label for="teacherAliasInput" style="display:block; text-align:left; margin-top: 15px;">Mã Alias của bạn (học sinh sẽ dùng để tìm bạn):</label>
      <input type="text" id="teacherAliasInput" placeholder="Ví dụ: sangmath" />
      <button onclick="updateTeacherAlias()">Cập nhật Alias</button>
      <button onclick="signOut()" style="background-color: #f44336;">Đăng xuất</button>
      <button onclick="showTeacherDashboard()" style="background-color: #2196F3;">Quản lý Đề thi / Lớp</button>
    </div>

    <!-- Màn hình Đăng nhập Học sinh -->
    <div id="loginScreen" class="login-container">
      <h2>Vào thi</h2>
      <label for="teacherAlias">Mã Giáo viên (Alias):</label>
      <input type="text" id="teacherAlias" placeholder="Nhập mã Alias của giáo viên (ví dụ: sangmath)" />
      <input type="text" id="examCode" placeholder="Nhập mã đề (ví dụ TEST)" />
      <label for="classSelect">Chọn Lớp:</label>
      <select id="classSelect">
        <option value="">-- Chọn lớp --</option>
      </select>
      <label for="studentSelect">Chọn Họ tên:</label>
      <select id="studentSelect">
        <option value="">-- Chọn tên --</option>
      </select>
      <button onclick="startExam()">Start</button>
      <p style="margin-top: 20px;">Bạn là giáo viên? <a href="#" onclick="showTeacherLogin()">Đăng nhập tại đây</a></p>
    </div>

    <!-- Hiệu ứng Loading -->
    <div id="loading" class="loading" style="display:none;">Đang load đề thi...</div>

    <!-- Đồng hồ đếm ngược -->
    <div id="timer-container" class="timer-container" style="display:none;">
      <div id="timer" class="timer"></div>
    </div>

    <!-- Giao diện đề thi -->
    <div id="quiz" style="display:none;"></div>
    <button id="gradeBtn" style="display:none;" onclick="gradeQuiz()"><i class="fas fa-check-circle"></i>Chấm điểm & Nộp bài</button>

    <!-- Bảng điểm -->
    <div id="result-container" style="display:none;">
      <h2>Kết quả bài thi</h2>
      <p>Chúc mừng bạn đã hoàn thành bài thi!</p>
      <p>Họ tên: <span id="student-name"></span></p>
      <p>Lớp: <span id="student-class"></span></p>
      <p>Mã đề: <span id="exam-code"></span></p>
      <p>Điểm số: <span id="score" class="score"></span></p>
    </div>

    <!-- Dashboard Giáo viên -->
    <div id="teacherDashboard" style="display:none;">
      <h2>Bảng điều khiển Giáo viên</h2>
      <p>Chào mừng <span id="teacherDashboardName"></span>. Bạn còn <span id="trialRemainingDays"></span> ngày dùng thử.</p>
      <div style="display:flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
        <button onclick="showUploadForm()" style="background-color: #4CAF50;">Tải lên Đề thi / Lớp</button>
        <button onclick="viewSubmissions()" style="background-color: #2196F3;">Xem Bài nộp</button>
        <button onclick="hideTeacherDashboard()" style="background-color: #f44336;">Quay lại màn hình chính</button>
      </div>


      <div id="uploadForm" style="display:none; margin-top: 20px; border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
          <h3>Tải lên dữ liệu</h3>
          <label for="fileInputExams" style="display:block; text-align:left; margin-bottom: 5px;">Tải lên đề thi (CSV/JSON):</label>
          <input type="file" id="fileInputExams" accept=".csv,.json" /><br><br>
          <button onclick="uploadExamsFile()" style="width:auto; padding: 8px 15px; font-size: 14px; background-color: #4CAF50;">Tải lên Đề thi</button>
          <p style="margin-top:10px; font-size: 13px; color: #666; text-align: left;">
            Format CSV/JSON đề thi: Mỗi hàng/đối tượng là 1 đề thi. Các cột/trường bắt buộc: <br>
            <code>examCode</code> (Mã đề), <code>keys</code> (Đáp án, VD: A|B|TF|1.23), <br>
            <code>cores</code> (Điểm số, VD: 1|0.25,0.5,0.75,1|1.5), <br>
            <code>questionTexts</code> (Nội dung câu hỏi, dùng \n cho xuống dòng), <br>
            <code>explanations</code> (Lời giải, dùng \n cho xuống dòng).
          </p>

          <hr style="margin: 25px 0;">

          <label for="fileInputClasses" style="margin-top: 20px; display:block; text-align:left; margin-bottom: 5px;">Tải lên lớp học (CSV/JSON):</label>
          <input type="file" id="fileInputClasses" accept=".csv,.json" /><br><br>
          <button onclick="uploadClassesFile()" style="width:auto; padding: 8px 15px; font-size: 14px; background-color: #2196F3;">Tải lên Lớp học</button>
          <p style="margin-top:10px; font-size: 13px; color: #666; text-align: left;">
            Format CSV/JSON lớp học: Mỗi hàng/đối tượng là 1 lớp. Các cột/trường bắt buộc:<br>
            <code>name</code> (Tên lớp, VD: 10A), <br>
            <code>students</code> (Danh sách tên học sinh cách nhau bằng dấu phẩy, VD: "Nguyễn A, Trần B").
          </p>
      </div>

      <div id="submissionsView" style="display:none; margin-top: 20px;">
          <h3>Bài nộp của học sinh</h3>
          <div style="overflow-x: auto;">
            <table border="1" style="width:100%; border-collapse: collapse; min-width: 600px;">
                <thead>
                    <tr>
                      <th>Thời gian</th>
                      <th>Mã đề</th>
                      <th>Họ tên</th>
                      <th>Lớp</th>
                      <th>Điểm</th>
                    </tr>
                </thead>
                <tbody id="submissionsTableBody">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
          </div>
      </div>
    </div>

    <!-- Liên kết với file JavaScript tùy chỉnh của bạn (đặt ở cuối body để HTML tải trước) -->
    <script src="js/main.js"></script>

  </body>
</html>